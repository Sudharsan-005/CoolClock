<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cool Clock</title>
 <link rel="icon" type="image/png" href="clock-icon.png"> 

<!-- Fonts -->
<link href="https://fonts.cdnfonts.com/css/curve-square" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

<style>
    :root {
        /* Original variables preserved */
        --digit-bg: #222;
        --digit-color: #fff;
        --digit-size: 100px;
        --digit-height: 120px;
        --digit-width: 80px;
        --gap-size: 12px;
        --colon-color: #444;
        --box-opacity: 1;
        --clock-font: 'Helvetica Neue', Arial, sans-serif; /* default */
    }

    body{
        background-color:#000;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        display:flex;
        flex-direction:column;
        justify-content:center;
        align-items:center;
        height:100vh;
        margin:0;
        font-family:var(--clock-font);
        color:#fff;
        overflow:hidden;
        transition: background-image 0.5s ease;
    }

    #bg-upload { display:none; }

    .flip-clock-container { display:flex; align-items:flex-start; }

    .ampm-indicator {
        font-weight:bold;
        margin-right:15px;
        padding-top:10px;
        letter-spacing:1px;
        color:var(--digit-color);
    }

    .flip-clock { display:flex; align-items:center; }

    .time-part { display:flex; gap:2px; }
    .time-part.minute, .time-part.second { margin-left: var(--gap-size); }
    .time-part.minute::before,
    .time-part.second::before {
        content: ':';
        font-size: var(--digit-size);
        line-height: var(--digit-height);
        margin-left: calc(var(--gap-size) / -2);
        margin-right: calc(var(--gap-size) / 2);
        color: var(--colon-color);
        font-weight: normal;
    }

    .digit-box {
        width: var(--digit-width);
        height: var(--digit-height);
        background-color: rgba(34,34,34,var(--box-opacity));
        border-radius:5px;
        font-size: var(--digit-size);
        line-height: var(--digit-height);
        text-align:center;
        font-weight:bold;
        box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        overflow:hidden;
        color: var(--digit-color);
    }

    .digit-box.hidden-bg {
        background-color: transparent !important;
        box-shadow: none !important;
    }

    .date-display {
        margin-top:30px;
        letter-spacing:6px;
        font-weight:normal;
        color: var(--digit-color);
    }

    /* keep responsive behavior for smaller screens */
    @media (max-width:600px){
        :root { --digit-size: 60px; --digit-height: 72px; --digit-width: 48px; }
    }
</style>
</head>
<body>

<input id="bg-upload" type="file" accept="image/*">

<div class="flip-clock-container">
    <div class="ampm-indicator" id="ampm-indicator">AM</div>

    <div class="flip-clock">
        <div class="time-part hour">
            <div class="digit-box" id="h1">1</div>
            <div class="digit-box" id="h2">2</div>
        </div>
        <div class="time-part minute">
            <div class="digit-box" id="m1">0</div>
            <div class="digit-box" id="m2">0</div>
        </div>
        <div class="time-part second">
            <div class="digit-box" id="s1">0</div>
            <div class="digit-box" id="s2">0</div>
        </div>
    </div>
</div>

<div class="date-display" id="date-display">TUE SEP 30</div>

<script>
/* =========================
   Keep original behavior, only fixes:
   - Font cycle on key '0'
   - AM/PM & date follow RGB effect
   - Key '8' properly toggles digit backgrounds
   ========================= */

const root = document.documentElement;
const style = getComputedStyle(root);
const ampmIndicator = document.getElementById('ampm-indicator');
const dateDisplay = document.getElementById('date-display');
const digitBoxes = document.querySelectorAll('.digit-box');

let is24HourFormat = false;
let showDigitBackground = true;
let showDateDisplay = true;

/* CLOCK (same as original, preserving leading zero) */
function setDigit(id, value){ document.getElementById(id).textContent = value; }

function updateClock(){
    const currentDate = new Date();
    let hours = currentDate.getHours();
    const minutes = currentDate.getMinutes();
    const seconds = currentDate.getSeconds();

    let hDisplay;
    if (is24HourFormat) {
        hDisplay = String(hours).padStart(2,'0');
        ampmIndicator.style.display = 'none';
    } else {
        const isPM = hours >= 12;
        let ampmText = isPM ? 'PM' : 'AM';
        hours = hours % 12;
        hours = hours ? hours : 12;
        hDisplay = String(hours).padStart(2,'0');
        ampmIndicator.textContent = ampmText;
        ampmIndicator.style.display = 'block';
    }

    const mStr = String(minutes).padStart(2,'0');
    const sStr = String(seconds).padStart(2,'0');

    setDigit('h1', hDisplay[0]);
    setDigit('h2', hDisplay[1]);
    setDigit('m1', mStr[0]);
    setDigit('m2', mStr[1]);
    setDigit('s1', sStr[0]);
    setDigit('s2', sStr[1]);

    const dayNames = ['SUN','MON','TUE','WED','THU','FRI','SAT'];
    const monthNames = ['JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG','SEP','OCT','NOV','DEC'];

    const day = dayNames[currentDate.getDay()];
    const month = monthNames[currentDate.getMonth()];
    const dateNum = currentDate.getDate();
    dateDisplay.textContent = `${day} ${month} ${dateNum}`;
}
updateClock();
setInterval(updateClock, 1000);

/* BACKGROUND UPLOAD (unchanged) */
const fileInput = document.getElementById('bg-upload');
fileInput.addEventListener('change', function(e){
    if (e.target.files && e.target.files[0]) {
        const reader = new FileReader();
        reader.onload = ev => document.body.style.backgroundImage = `url('${ev.target.result}')`;
        reader.readAsDataURL(e.target.files[0]);
    }
});

/* ZOOM (unchanged behavior) */
let currentSize = parseInt(style.getPropertyValue('--digit-size').replace('px',''));
const SIZE_RATIO_HEIGHT = 1.2;
const SIZE_RATIO_WIDTH = 0.8;
const DATE_SIZE_RATIO = 0.2;
function setClockSize(newSize){
    if (newSize < 40 || newSize > 200) return;
    currentSize = newSize;
    root.style.setProperty('--digit-size', `${currentSize}px`);
    root.style.setProperty('--digit-height', `${currentSize*SIZE_RATIO_HEIGHT}px`);
    root.style.setProperty('--digit-width', `${currentSize*SIZE_RATIO_WIDTH}px`);
    const newDateSize = currentSize * DATE_SIZE_RATIO;
    dateDisplay.style.fontSize = `${newDateSize}px`;
    ampmIndicator.style.fontSize = `${newDateSize}px`;
}
setClockSize(currentSize);

/* COLOR & BRIGHTNESS */
let currentLightness = 70;
let currentOpacity = 1.0;
const BRIGHTNESS_STEP_L = 10;
const BRIGHTNESS_STEP_O = 0.1;
const MIN_LIGHTNESS = 30;
const MAX_LIGHTNESS = 100;
const MIN_OPACITY = 0.3;
const MAX_OPACITY = 1.0;

const colors = ['#fff','#00ff00','#00c0ff','#ff80ff','#ffff00','#ff0000','#a020f0','#ffa500','#000000'];
let colorIndex = 0;

function hexToHsl(hex){
    // supports #rgb and #rrggbb
    let r=0,g=0,b=0;
    if(hex.length===4){
        r = parseInt(hex[1]+hex[1],16);
        g = parseInt(hex[2]+hex[2],16);
        b = parseInt(hex[3]+hex[3],16);
    } else {
        r = parseInt(hex.substring(1,3),16);
        g = parseInt(hex.substring(3,5),16);
        b = parseInt(hex.substring(5,7),16);
    }
    r/=255; g/=255; b/=255;
    let max = Math.max(r,g,b), min = Math.min(r,g,b);
    let h=0,s=0,l=(max+min)/2;
    if(max!==min){
        let d = max-min;
        s = l>0.5 ? d/(2-max-min) : d/(max+min);
        switch(max){
            case r: h = (g-b)/d + (g<b?6:0); break;
            case g: h = (b-r)/d + 2; break;
            case b: h = (r-g)/d + 4; break;
        }
        h /= 6;
    }
    return { h: Math.round(h*360), s: Math.round(s*100), l: Math.round(l*100) };
}

function applyStaticColor(newColor){
    stopRgbEffect(); // ensure RGB not running
    if (newColor.startsWith('#')) {
        const hsl = hexToHsl(newColor);
        const final = `hsl(${hsl.h}, ${hsl.s}%, ${currentLightness}%)`;
        root.style.setProperty('--digit-color', final);
        // AM/PM & date follow this color
        ampmIndicator.style.color = final;
        dateDisplay.style.color = final;
    } else {
        // fallback for named colors
        const final = `hsl(0,0%,${currentLightness}%)`;
        root.style.setProperty('--digit-color', newColor);
        ampmIndicator.style.color = newColor;
        dateDisplay.style.color = newColor;
    }

    // handle box opacity and hidden-bg
    if (showDigitBackground) {
        root.style.setProperty('--box-opacity', currentOpacity);
        digitBoxes.forEach(box => box.classList.remove('hidden-bg'));
    } else {
        root.style.setProperty('--box-opacity', 0);
        digitBoxes.forEach(box => box.classList.add('hidden-bg'));
    }
}

function cycleColor(){
    colorIndex = (colorIndex + 1) % colors.length;
    applyStaticColor(colors[colorIndex]);
}

/* SLOW RGB (fix: AM/PM & date follow) */
let rgbInterval = null;
let hue = 0;
function startRgbEffect(){
    if (rgbInterval) { stopRgbEffect(); return; }
    // ensure digit bg respects showDigitBackground
    root.style.setProperty('--box-opacity', showDigitBackground ? currentOpacity : 0);
    rgbInterval = setInterval(() => {
        hue = (hue + 1) % 360;
        const hslColor = `hsl(${hue}, 100%, ${currentLightness}%)`;
        root.style.setProperty('--digit-color', hslColor);
        ampmIndicator.style.color = hslColor; // FIX: AM/PM follows
        dateDisplay.style.color = hslColor;   // FIX: DATE follows
    }, 50);
}

function stopRgbEffect(){
    if (rgbInterval) {
        clearInterval(rgbInterval);
        rgbInterval = null;
        // when stopping, restore current static color (use current colorIndex)
        applyStaticColor(colors[colorIndex]);
    }
}

/* FONT CYCLE (key 0) */
const fonts = [
    "'Curve Square', sans-serif",
    "'Orbitron', sans-serif",
    "'JetBrains Mono', monospace",
    "'Helvetica Neue', Arial, sans-serif"
];
let fontIndex = 0;
function cycleFont(){
    fontIndex = (fontIndex + 1) % fonts.length;
    root.style.setProperty('--clock-font', fonts[fontIndex]);
    // also update body font to ensure layout consistency
    document.body.style.fontFamily = fonts[fontIndex];
}

/* INITIAL COLOR APPLY */
applyStaticColor(colors[colorIndex]);

/* KEYBOARD CONTROLS (unchanged mapping, but fix case '8') */
document.addEventListener('keydown', function(event){
    switch (event.key) {
        case '=': fileInput.click(); break;
        case '1': setClockSize(currentSize - 10); break;
        case '2': setClockSize(currentSize + 10); break;
        case '3': cycleColor(); break;
        case '4': startRgbEffect(); break;
        case '5':
            currentLightness = Math.max(MIN_LIGHTNESS, currentLightness - BRIGHTNESS_STEP_L);
            currentOpacity = Math.max(MIN_OPACITY, currentOpacity - BRIGHTNESS_STEP_O);
            // apply lightness to current state (if rgb running, rgb loop uses currentLightness)
            if (!rgbInterval) {
                // when static, reapply using current colorIndex
                applyStaticColor(colors[colorIndex]);
            }
            root.style.setProperty('--box-opacity', currentOpacity);
            break;
        case '6':
            currentLightness = Math.min(MAX_LIGHTNESS, currentLightness + BRIGHTNESS_STEP_L);
            currentOpacity = Math.min(MAX_OPACITY, currentOpacity + BRIGHTNESS_STEP_O);
            if (!rgbInterval) {
                applyStaticColor(colors[colorIndex]);
            }
            root.style.setProperty('--box-opacity', currentOpacity);
            break;
        case '7':
            is24HourFormat = !is24HourFormat;
            updateClock();
            break;
        case '8':
            // FIX: toggle visible background properly
            showDigitBackground = !showDigitBackground;
            if (showDigitBackground) {
                root.style.setProperty('--box-opacity', currentOpacity);
                digitBoxes.forEach(box => box.classList.remove('hidden-bg'));
            } else {
                root.style.setProperty('--box-opacity', 0);
                digitBoxes.forEach(box => box.classList.add('hidden-bg'));
            }
            // if rgb is running, refresh it's applied color (rgb loop already updates color)
            break;
        case '9':
            showDateDisplay = !showDateDisplay;
            dateDisplay.style.display = showDateDisplay ? 'block' : 'none';
            break;
        case '0':
            cycleFont();
            break;
    }
});
</script>
</body>
</html>
